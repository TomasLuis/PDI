{% load static %} 

<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Conversas - SkillCraft</title>
    <link rel="stylesheet" href="{% static 'css/minhas_conversas.css' %}"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> 

    <style>
html {
  height: 100%;
  margin: 0;
}

body {
  display: flex;
  flex-direction: column;
  height: 100%;
  font-family: sans-serif;
  margin: 0;
}

header { 
  background: #8B5E34;
  color: white; 
  padding: 15px 5%; 
  text-align: center; 
  display: flex; 
  justify-content: center; 
  align-items: center; 
  position: relative; 
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.logo img { height: 60px; }

nav { position: absolute; right: 5%; }
nav ul { list-style: none; display: flex; gap: 20px; margin: 0; padding: 0; }
nav ul li a {
  color: white; 
  text-decoration: none; 
  font-weight: 500; 
  font-size: 16px; 
  transition: color 0.3s; 
}
nav ul li a:hover { color: #d4a373; }

.container {
  flex: 1;
}

footer {
  background: #8B5E34;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  padding: 15px 5%;
  margin-top: auto;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
}
    </style>

</head>
<body>
  <header>
    <div class="logo">
        <img src="{% static 'imagens/logo.png' %}" alt="SkillCraft">
    </div>
    <nav>
        <ul>
            
        </ul>
    </nav>
</header>

    <div class="container mt-4">
    {% if papel == "cliente" %}
      <h2>Mensagens com Prestadores de Serviço</h2>
    {% else %}
      <h2>Mensagens dos Clientes</h2>
    {% endif %}

    {% if conversas %}
      <ul class="list-group">
        {% for conversa in conversas %}
          {% if conversa.participant1 == user %}
            {% with other_user=conversa.participant2 %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {% if papel == "cliente" %}Prestador de Serviço:{% else %}Cliente:{% endif %}
                {% if other_user.perfil.nome %}
                  {{ other_user.perfil.nome }}
                {% else %}
                  {{ other_user.username }}
                {% endif %}
                <a href="{% url 'chat:chat_room' conversa.id %}"
                   class="btn btn-primary btn-sm position-relative open-chat-btn"
                   onclick="this.querySelector('.badge')?.remove()">
                  Abrir Chat
                  {% if conversa.unread > 0 %}
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                      {{ conversa.unread }}
                      <span class="visually-hidden">novas mensagens</span>
                    </span>
                  {% endif %}
                </a>
              </li>
            {% endwith %}
          {% else %}
            {% with other_user=conversa.participant1 %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {% if papel == "cliente" %}Prestador de Serviço:{% else %}Cliente:{% endif %}
                {% if other_user.perfil.nome %}
                  {{ other_user.perfil.nome }}
                {% else %}
                  {{ other_user.username }}
                {% endif %}
                <a href="{% url 'chat:chat_room' conversa.id %}"
                   class="btn btn-primary btn-sm position-relative open-chat-btn"
                   onclick="this.querySelector('.badge')?.remove()">
                  Abrir Chat
                  {% if conversa.unread > 0 %}
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                      {{ conversa.unread }}
                      <span class="visually-hidden">novas mensagens</span>
                    </span>
                  {% endif %}
                </a>
              </li>
            {% endwith %}
          {% endif %}
        {% endfor %}
      </ul>
    {% else %}
      <p>Ainda não tens conversas iniciadas.</p>
    {% endif %}
  </div>

    {# Seu rodapé (footer) #}
    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                {# Use {% static %} para imagens também #}
                <img src="{% static 'imagens/slogan.png' %}" alt="Slogan">
            </div>
            <div class="footer-links">
                <a href="{% url 'index:index' %}">Página inicial</a> {# Use a tag url #}
                 <a href="quem_somos">Quem somos?</a> {# Assumindo que 'quem_somos' é um nome de URL #}
            </div>
            <div class="copyright">
                <p>© SkillCraft</p>
                <p>Portugal, Coimbra, Quinta Agrícola, Bencanta, 3045-601</p>
            </div>
        </div>
    </footer>

    {# Inclua o script do Bootstrap se estiver a usá-lo #}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.open-chat-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const badge = this.querySelector('.badge');
        if (badge) badge.remove();
      });
    });
  });
</script>
</body>
</html>